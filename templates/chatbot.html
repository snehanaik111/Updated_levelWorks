

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher's Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: #f8f9fa;
        }
        .sidebar {
            z-index: 9;
            width: 250px;
            background: linear-gradient(135deg, #2d7d4d, #3d3af4);
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar a {
            display: block;
            padding: 15px;
            color: white;
            text-decoration: none;
            font-weight: bold;
            transition: 0.3s;
            border-radius: 5px;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .content {
            margin-left: 260px;
            flex-grow: 1;
            padding: 40px;
            transition: 0.3s;
            overflow-y: auto;
        }
        .content h3 {
            margin-bottom: 20px;
        }
        .card {
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .menu-toggle {
            display: none;
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.show {
                transform: translateX(0);
            }
            .content {
                margin-left: 0;
                padding: 20px;
            }
            .menu-toggle {
                display: block;
                z-index: 1000;
            }
        }
        .content-page {
            text-align: left;
            margin-top: 20px; /* Consistent spacing under the heading */
        }




/* General Styles */
.flashcards {
    font-family: 'Arial', sans-serif;
}

.section-title {
    font-size: 2rem;
    text-align: center;
    margin-bottom: 20px;
    color: #3b5f75;
}

.topic-dropdown, .age-dropdown {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
    border-radius: 5px;
    border: 1px solid #ddd;
}

.start-btn {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 1.2rem;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.start-btn:hover {
    background-color: #0056b3;
}

/* Flashcard Styles */
.flashcard-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
}

.flashcard {
    width: 220px;
    height: 320px;
    perspective: 1000px;
    margin: 10px;
    cursor: pointer;
    transition: transform 0.5s;
}

.flashcard:hover {
    transform: scale(1.05);
}

.flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.6s;
}

.flashcard.flipped .flashcard-inner {
    transform: rotateY(180deg);
}

.flashcard-front, .flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    text-align: center;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.flashcard-front {
    background-color: #f7f7f7;
    color: #333;
}

.flashcard-back {
    background-color: #3498db;
    color: #fff;
    transform: rotateY(180deg);
}

.flashcard-content {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
}

/* Responsive Design */
@media (max-width: 768px) {
    .flashcard-container {
        flex-direction: column;
        align-items: center;
    }
    
    .flashcard {
        width: 180px;
        height: 270px;
    }
}

#announcements {
            padding: 20px;
        }

        #calendar-container {
            margin: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        #calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-gap: 5px;
            margin-top: 20px;
        }

        .calendar-day {
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: background-color 0.3s;
            background-color: #fff;
            border-radius: 5px;
        }

        .calendar-day:hover {
            background-color: #f0f0f0;
        }

        .calendar-day.success {
            background-color: #d4edda; /* Success color */
        }

        .calendar-day.danger {
            background-color: #f8d7da; /* Danger color */
        }

        .calendar-day.primary {
            background-color: #cce5ff; /* Primary color */
        }

        .calendar-header button {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .calendar-header h3 {
            margin: 0;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
        }

        .weekdays div {
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        .popup-content button {
            margin-top: 20px;
        }

    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2 class="text-center mb-4">Teacher's Dashboard</h2>
        <a href="#" onclick="loadContent('dashboard')" class="active">Dashboard</a>
       <!--  <a href="#" onclick="loadContent('planner')">Planner</a>
        <a href="#" onclick="loadContent('worksheets')">Worksheets</a>
        <a href="#" onclick="loadContent('flashcards')">Flashcards</a>
        <a href="#" onclick="loadContent('stories')">Stories</a>
        <a href="#" onclick="loadContent('announcements')">Announcements</a> -->
        <a href="/" class="nav-link">Home</a></li>
    
    </div>
    <span class="menu-toggle" onclick="toggleSidebar()">&#9776;</span>
    <div class="content" id="main-content">
        <h3>Welcome to the Teacher's Dashboard</h3>

    <!-- Dashboard Section -->
<div id="dashboard" class="content-page">
    <div class="row g-4">
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3">
                <div class="card-body">
                    <i class="fas fa-file-alt fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title">Worksheets Used</h5>
                    <p class="card-text">3/10</p>
                    <!-- Generate Worksheet Button -->
                    <button class="btn btn-primary" onclick="loadContent('worksheets')">Generate Worksheet</button>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3" onclick="logActivity('Upcoming Events')">
                <div class="card-body">
                    <i class="fas fa-calendar-alt fa-3x mb-3 text-success"></i>
                    <h5 class="card-title">Upcoming Events</h5>
                    <p class="card-text">February 12 2025</p>
                    <!-- Generate Worksheet Button -->
                    <button class="btn btn-success" onclick="loadContent('announcements')">View Calender</button>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3" onclick="logActivity('Flashcards Used')">
                <div class="card-body">
                    <i class="fas fa-book fa-3x mb-3 text-danger"></i>
                    <h5 class="card-title">Flashcards Used</h5>
                    <p class="card-text">5/10</p>
                      <!-- Generate Worksheet Button -->
                      <button class="btn btn-danger" onclick="loadContent('flashcards')">Generate Flashcard</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Activities Table  <button class="btn btn-primary" onclick="reloadActivityTable()">Reload Activities</button> -->
    <div class="mt-4">
        <h5 class="mb-3">User Activities</h5>
        <div class="d-flex justify-content-between align-items-center mb-2">
           
        </div>
        <div class="table-responsive">
            <table class="table table-hover table-striped table-bordered" id="activityTable">
                <thead class="thead-dark">
                    <tr>
                        <th>#</th>
                        <th>Activity</th>
                        <th>Timestamp</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Sample Activities -->
                    <tr>
                        <td>1</td>
                        <td>Worksheets Used</td>
                        <td>2025-02-06 10:30 AM</td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="viewPDF(1)">View</button>
                            <button class="btn btn-success btn-sm" onclick="downloadPDF(1)">Download</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Upcoming Events</td>
                        <td>2025-02-06 11:00 AM</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Flashcards Used</td>
                        <td>2025-02-06 11:30 AM</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Worksheets Used</td>
                        <td>2025-02-06 12:00 PM</td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="viewPDF(4)">View</button>
                            <button class="btn btn-success btn-sm" onclick="downloadPDF(4)">Download</button>
                        </td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Upcoming Events</td>
                        <td>2025-02-06 12:30 PM</td>
                        <td>-</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let activityCount = 5; // Start from 5, since we have 5 sample activities
    const activities = [
        { id: 1, activity: "Worksheets Used", timestamp: "2025-02-06 10:30 AM", pdfUrl: "/static/images/Synpdf.pdf" },
        { id: 2, activity: "Upcoming Events", timestamp: "2025-02-06 11:00 AM" },
        { id: 3, activity: "Flashcards Used", timestamp: "2025-02-06 11:30 AM" },
        { id: 4, activity: "Worksheets Used", timestamp: "2025-02-06 12:00 PM", pdfUrl: "/static/images/Jolly_Phonics_2-4_Years.pdf" },
        { id: 5, activity: "Upcoming Events", timestamp: "2025-02-06 12:30 PM" }
    ]; // Pre-populate with example activities

    // Function to log user activity when a "Generate Worksheet" button is clicked
async function generateWorksheet() {
    let topic = selectedTopic || document.querySelector("#topic-dropdown button.active")?.dataset.value;
    let ageGroup = selectedAgeGroup || document.querySelector("#age-dropdown button.active")?.dataset.value;

    if (!topic || !ageGroup) {
        alert("Please select a topic and an age group.");
        return;
    }

    // Show loading message
    const container = document.getElementById("worksheet-display");
    container.innerHTML = `
        <div id="loading-message" class="text-center mt-3">
            <h4>Generating content...</h4>
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    `;

      // Give the browser time to render the spinner
      await new Promise(resolve => setTimeout(resolve, 5000));  

    const prompt = `Generate a JSON object containing an array called "data" with 5 elements. 
Each element should be a string-based question for a worksheet on the topic '${topic}' for 
${ageGroup}-year-old children. Ensure the response is valid JSON with no extra text.`;

    try {
        const worksheetData = await fetchAIResponse(prompt);

        if (!worksheetData) {
            throw new Error("AI response is empty.");
        }

        displayWorksheet(worksheetData, topic, ageGroup);
    } catch (error) {
        console.error("‚ùå Error fetching AI response:", error);
        alert("Failed to generate worksheet. Please try again.");
        
        // Remove loading message on error
        container.innerHTML = "";
    }



    if (worksheetData) {
        displayWorksheet(worksheetData);
    }
        const timestamp = new Date().toLocaleString();  // Get the current timestamp
        activityCount++;
        const newActivity = { id: activityCount, activity: "Worksheets Used", timestamp: timestamp, pdfUrl: "path_to_pdf_" + activityCount + ".pdf" };

        activities.push(newActivity); // Store the activity

        // Add the activity to the table
        addActivityToTable(newActivity.id, newActivity.activity, newActivity.timestamp, newActivity.pdfUrl);
    }

    // Function to dynamically add activity to the table
    function addActivityToTable(id, activity, timestamp, pdfUrl = null) {
        const tableBody = document.querySelector("#activityTable tbody");

        let actionBtns = '-';
        if (activity === "Worksheets Used") {
            actionBtns = `
                <button class="btn btn-info btn-sm" onclick="viewPDF(${id})">View</button>
                <button class="btn btn-success btn-sm" onclick="downloadPDF(${id})">Download</button>
            `;
        }

        const row = `
            <tr>
                <td>${id}</td>
                <td>${activity}</td>
                <td>${timestamp}</td>
                <td>${actionBtns}</td>
            </tr>
        `;

        tableBody.innerHTML += row;
    }

    // Function to view the PDF
    function viewPDF(id) {
        const activity = activities.find(activity => activity.id === id);
        if (activity && activity.pdfUrl) {
            window.open(activity.pdfUrl, "_blank");
        } else {
            alert("No PDF available for this activity.");
        }
    }

    // Function to download the PDF
    function downloadPDF(id) {
        const activity = activities.find(activity => activity.id === id);
        if (activity && activity.pdfUrl) {
            window.location.href = activity.pdfUrl;
        } else {
            alert("No PDF available for this activity.");
        }
    }

    // Function to reload the activity table (e.g., after an update)
    function reloadActivityTable() {
        const tableBody = document.querySelector("#activityTable tbody");
        tableBody.innerHTML = ''; // Clear the table before reloading
        activities.forEach(activity => {
            addActivityToTable(activity.id, activity.activity, activity.timestamp, activity.pdfUrl);
        });
    }

    // Initial load of activities
    reloadActivityTable();
</script>

<!-- Required Libraries -->
<script src="https://kit.fontawesome.com/a076d05399.js"></script>


        <!-- Planner Section -->
        <div id="planner" class="content-page" style="display:none;">
            <h3>Planner Section</h3>
            <p>Details about planning go here...</p>
        </div>

   <!-- Worksheets Section Container -->
<div id="worksheets" class="content-page" style="display:none;">
    <div class="container my-5">
        <div class="shadow p-4 rounded bg-white">
            <h3>Worksheets Section</h3>

            <!-- Topic Selection Buttons -->
            <div class="mb-3">
                <h5>Select a Topic:</h5>
                <div id="topic-buttons" class="btn-group-horizontal" role="group">
                    <button type="button" class="btn btn-primary mb-2" data-value="Synthetic Phonics">Synthetic Phonics</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Systematic Synthetic Approach">Systematic Synthetic Approach</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Fundamental Phonics Rules">Fundamental Phonics Rules</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="5 Major Principles Of Phonics">5 Major Principles Of Phonics</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Jolly Phonics Methodology">Jolly Phonics Methodology</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="42 Sounds With Actions">42 Sounds With Actions</button>
                    <!-- Hidden extra options -->
                    <div id="extra-topics" style="display:none;">
                        <button type="button" class="btn btn-primary mb-2" data-value="Blending & Segmenting">Blending & Segmenting</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Tricky Words">Tricky Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Alternatives">Alternatives</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Diagraphs & Trigraphs">Diagraphs & Trigraphs</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Sight Words">Sight Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Rhyming Words">Rhyming Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Long & Short Vowel">Long & Short Vowel</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Learning Phonograms">Learning Phonograms</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Stories & Actions">Stories & Actions</button>
                    </div>
                    <button type="button" class="btn btn-link" id="show-more-topics">+ More</button>
                </div>
            </div>

            <!-- Age Group Selection Buttons -->
            <div class="mb-3">
                <h5>Select Age Group:</h5>
                <div id="age-buttons" class="btn-group-horizontal" role="group">
                    <button type="button" class="btn btn-secondary mb-2" data-value="2-4">2-4 Years</button>
                    <button type="button" class="btn btn-secondary mb-2" data-value="4-5">4-5 Years</button>
                    <button type="button" class="btn btn-secondary mb-2" data-value="5-10">5-10 Years</button>
                    <!-- Hidden extra options -->
                    <div id="extra-age-groups" style="display:none;">
                        <button type="button" class="btn btn-secondary mb-2" data-value="6-8">6-8 Years</button>
                        <button type="button" class="btn btn-secondary mb-2" data-value="9-12">9-12 Years</button>
                    </div>
                    <button type="button" class="btn btn-link" id="show-more-age-groups">+ More</button>
                </div>
            </div>

            <button class="btn btn-success" onclick="generateWorksheet()">Generate AI Worksheet</button>
            <div id="worksheet-display" class="mt-4"></div> <!-- Display selected worksheet here -->
        </div>
    </div>
</div>

<script>
    // Pre-defined PDF URLs for each topic and age group combination
    const pdfUrls = {
        "Synthetic Phonics": {
            "2-4": "/static/images/Synpdf.pdf",
            "4-5": "/static/images/Jolly_Phonics_2-4_Years.pdf",
            "5-10": "path/to/synthetic_phonics_5_10.pdf"
        },
        "Systematic Synthetic Approach": {
            "2-4": "/static/images/Blending_Segmenting_5-7_Years.pdf",
            "4-5": "path/to/systematic_synthetic_4_5.pdf",
            "5-10": "path/to/systematic_synthetic_5_10.pdf"
        },
        "Fundamental Phonics Rules": {
            "2-4": "path/to/fundamental_phonics_2_4.pdf",
            "4-5": "path/to/fundamental_phonics_4_5.pdf",
            "5-10": "path/to/fundamental_phonics_5_10.pdf"
        },
        // Add more topics with their respective PDFs
    };

    // Initialize variables to store selected topic and age group
    let selectedTopic = '';
    let selectedAgeGroup = '';

    // Event listener for topic button selection
    document.getElementById('topic-buttons').addEventListener('click', function(event) {
        if (event.target.tagName === 'BUTTON') {
            // Deselect other buttons
            Array.from(event.currentTarget.children).forEach(button => button.classList.remove('active'));
            // Mark this button as selected
            event.target.classList.add('active');
            selectedTopic = event.target.getAttribute('data-value');
        }
    });

    // Event listener for age group button selection
    document.getElementById('age-buttons').addEventListener('click', function(event) {
        if (event.target.tagName === 'BUTTON') {
            // Deselect other buttons
            Array.from(event.currentTarget.children).forEach(button => button.classList.remove('active'));
            // Mark this button as selected
            event.target.classList.add('active');
            selectedAgeGroup = event.target.getAttribute('data-value');
        }
    });

    // Event listener to show more topics
    document.getElementById('show-more-topics').addEventListener('click', function() {
        const extraTopics = document.getElementById('extra-topics');
        extraTopics.style.display = extraTopics.style.display === 'none' ? 'block' : 'none';
        this.textContent = extraTopics.style.display === 'block' ? '- Less' : '+ More';
    });

    // Event listener to show more age groups
    document.getElementById('show-more-age-groups').addEventListener('click', function() {
        const extraAgeGroups = document.getElementById('extra-age-groups');
        extraAgeGroups.style.display = extraAgeGroups.style.display === 'none' ? 'block' : 'none';
        this.textContent = extraAgeGroups.style.display === 'block' ? '- Less' : '+ More';
    });

    // Event listener for creating the worksheet
    document.getElementById('create-worksheet').addEventListener('click', function() {
        if (selectedTopic && selectedAgeGroup) {
            // Get the PDF URL based on selected topic and age group
            const pdfUrl = pdfUrls[selectedTopic] ? pdfUrls[selectedTopic][selectedAgeGroup] : '';

            if (pdfUrl) {
                // Display the PDF in an iframe
                const iframe = `<iframe src="${pdfUrl}" width="100%" height="500px"></iframe>`;
                document.getElementById('worksheet-display').innerHTML = iframe;

                // Enable the download PDF button
                document.getElementById('download-pdf').style.display = 'block';
                
                // Store the PDF URL for download button
                document.getElementById('download-pdf').onclick = function() {
                    window.location.href = pdfUrl; // Download the PDF
                };
            } else {
                alert("PDF not available for this topic and age group.");
            }
        } else {
            alert("Please select both a topic and an age group.");
        }
    });
</script>






      <!-- Flashcards Section -->
<div id="flashcards" class="content-page" style="display:none;">
    <h3>Flashcards Section</h3>
    
    <!-- Topic Selection Dropdown -->
    <div class="mb-3">
        <h5>Select a Topic:</h5>
        <select id="topic-dropdown1" class="form-control">
            <option value="">Select a Topic</option>
            <option value="Synthetic Phonics">Synthetic Phonics</option>
            <option value="Systematic Synthetic Approach">Systematic Synthetic Approach</option>
            <option value="Fundamental Phonics Rules">Fundamental Phonics Rules</option>
            <option value="5 Major Principles Of Phonics">5 Major Principles Of Phonics</option>
            <option value="Jolly Phonics Methodology">Jolly Phonics Methodology</option>
            <option value="42 Sounds With Actions">42 Sounds With Actions</option>
            <option value="Blending & Segmenting">Blending & Segmenting</option>
            <option value="Tricky Words">Tricky Words</option>
            <option value="Alternatives">Alternatives</option>
            <option value="Diagraphs & Trigraphs">Diagraphs & Trigraphs</option>
            <option value="Sight Words">Sight Words</option>
            <option value="Rhyming Words">Rhyming Words</option>
            <option value="Long & Short Vowel">Long & Short Vowel</option>
            <option value="Learning Phonograms">Learning Phonograms</option>
            <option value="Stories & Actions">Stories & Actions</option>
        </select>
    </div>

    <!-- Age Group Selection -->
    <div class="mb-3">
        <h5>Select Age Group:</h5>
        <select id="age-dropdown1" class="form-control">
            <option value="">Select an Age Group</option>
            <option value="2-4">2-4 Years</option>
            <option value="4-5">4-5 Years</option>
            <option value="5-10">5-10 Years</option>
        </select>
    </div>

    <!-- Start Flashcards Button -->
    <div class="mb-3">
        <button class="btn btn-primary" onclick="generateFlashcards()">Generate AI Flashcards</button>
    </div>

    <!-- Flashcard Container -->
    <div id="flashcard-container" class="d-flex justify-content-center mt-4">
        <div id="loading-popup" class="popup" style="display:none;">
            <div class="popup-content">
                <h3 id="loading-message">Loading...</h3>
            </div>
        </div>
        
    </div>
</div>



<!-- JavaScript (for flashcard creation and flipping functionality) -->
<script>
function showLoadingPopup(message) {
    document.getElementById("loading-message").innerText = message;
    document.getElementById("loading-popup").style.display = "flex";
}

function hideLoadingPopup() {
    document.getElementById("loading-popup").style.display = "none";
}

async function generateFlashcards() {
    let topic = document.getElementById("topic-dropdown1").value;
    let ageGroup = document.getElementById("age-dropdown1").value;

    if (!topic || !ageGroup) {
        alert("Please select a topic and an age group.");
        return;
    }

    const prompt = `Generate a JSON object with an array called "flashcards". 
Each element should be an object containing "question" and "answer" fields. 
The topic is '${topic}', and the age group is '${ageGroup}'. Ensure the response is valid JSON with no extra text.`;

    const flashcardData = await fetchAIResponse(prompt);

    if (flashcardData) {
        displayFlashcards(flashcardData);
    }
}

function displayFlashcards(flashcards) {
    const container = document.getElementById("flashcard-container");
    container.innerHTML = "<h4>Generated Flashcards</h4>";

    // Ensure `flashcards` is properly parsed
    if (typeof flashcards === "string") {
        try {
            flashcards = JSON.parse(flashcards); // Convert string to JSON if needed
        } catch (error) {
            console.error("‚ùå Failed to parse AI response as JSON:", error);
            alert("Invalid flashcard data received from AI.");
            return;
        }
    }

    if (!flashcards || !Array.isArray(flashcards.flashcards)) {
        console.error("‚ùå AI response does not contain a valid 'flashcards' array:", flashcards);
        alert("Error: AI response format is incorrect.");
        return;
    }

    flashcards.flashcards.forEach((card, index) => {
        const flashcard = document.createElement("div");
        flashcard.classList.add("flashcard");
        flashcard.innerHTML = `
            <div class="flashcard-inner">
                <div class="flashcard-front">${card.question}</div>
                <div class="flashcard-back">${card.answer}</div>
            </div>
        `;
        flashcard.addEventListener('click', () => flashcard.classList.toggle('flipped'));
        container.appendChild(flashcard);
    });

    container.innerHTML += `<button class="btn btn-primary mt-2" onclick="downloadFlashcardPDF()">Download as PDF</button>`;
}


function downloadFlashcardPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.text("Generated Flashcards", 10, 10);

    let yOffset = 20;
    document.querySelectorAll(".flashcard-front").forEach((front, index) => {
        let answer = document.querySelectorAll(".flashcard-back")[index].innerText;
        doc.text(`${index + 1}. ${front.innerText} - ${answer}`, 10, yOffset);
        yOffset += 10;
    });

    doc.save("flashcards.pdf");
}


document.getElementById('start-flashcards').addEventListener('click', function() {
    const topic = document.getElementById('topic-dropdown1').value;
    const ageGroup = document.getElementById('age-dropdown1').value;
    
    if (!topic || !ageGroup) {
        alert("Please select a topic and an age group.");
        return;
    }

    // Sample flashcards data for each topic and age group
    const flashcards = getFlashcardsData(topic, ageGroup);

    // Clear the container before adding new flashcards
    const flashcardContainer = document.getElementById('flashcard-container');
    flashcardContainer.innerHTML = '';

    // Show flashcards dynamically
    flashcards.forEach(card => {
        const flashcard = createFlashcard(card.question, card.answer);
        flashcardContainer.appendChild(flashcard);
    });
});

function getFlashcardsData(topic, ageGroup) {
    // Sample flashcards data based on topic and age group
    const flashcards = {
        'Synthetic Phonics': {
            '2-4': [
                { question: "What sound does 'a' make?", answer: "Ah" },
                { question: "What sound does 'b' make?", answer: "Buh" },
            ],
            '4-5': [
                { question: "What sound does 'c' make?", answer: "Cuh" },
                { question: "What sound does 'd' make?", answer: "Duh" },
            ],
            '5-10': [
                { question: "What is the sound for 'ch'?", answer: "Chuh" },
                { question: "What is the sound for 'sh'?", answer: "Shh" },
            ]
        },
        'Systematic Synthetic Approach': {
            '2-4': [
                { question: "What is the first sound of 'cat'?", answer: "Cuh" },
                { question: "What is the first sound of 'dog'?", answer: "Duh" },
            ],
            '4-5': [
                { question: "What is the first sound of 'mat'?", answer: "Mmm" },
                { question: "What is the first sound of 'bat'?", answer: "Buh" },
            ],
            '5-10': [
                { question: "What is the sound for 'ph'?", answer: "Fuh" },
                { question: "What is the sound for 'ou'?", answer: "Ow" },
            ]
        },
        'Fundamental Phonics Rules': {
            '2-4': [
                { question: "What is the sound for 's'?", answer: "Sss" },
                { question: "What is the sound for 't'?", answer: "Tuh" },
            ],
            '4-5': [
                { question: "What is the sound for 'm'?", answer: "Mmm" },
                { question: "What is the sound for 'n'?", answer: "Nuh" },
            ],
            '5-10': [
                { question: "What is the sound for 'ar'?", answer: "Arh" },
                { question: "What is the sound for 'er'?", answer: "Er" },
            ]
        }
    };

    return flashcards[topic][ageGroup] || [];
}

function createFlashcard(question, answer) {
    const flashcard = document.createElement('div');
    flashcard.classList.add('flashcard');
    flashcard.innerHTML = `
        <div class="flashcard-inner">
            <div class="flashcard-front">
                <div>${question}</div>
            </div>
            <div class="flashcard-back">
                <div>${answer}</div>
            </div>
        </div>
    `;
    
    flashcard.addEventListener('click', function() {
        flashcard.classList.toggle('flipped');
    });

    return flashcard;
}
</script>


        <!-- Stories Section -->
        <div id="stories" class="content-page" style="display:none;">
            <h3>Stories Section</h3>
            <p>Details about stories go here...</p>
        </div>

         <!-- Announcements Section -->
    <div id="announcements" class="content-page" style="display:block;">
        <h3>Upcoming Events</h3>
        <div id="calendar" class="calendar-container">
            <div class="calendar-header">
                <button id="prev-month" onclick="changeMonth(-1)" class="btn btn-outline-primary">&#8592; Previous</button>
                <h3 id="calendar-month-year"></h3>
                <button id="next-month" onclick="changeMonth(1)" class="btn btn-outline-primary">Next &#8594;</button>
            </div>
            
            <!-- Weekdays Row -->
            <div class="weekdays">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>

            <!-- Calendar Grid -->
            <div id="calendar-grid"></div>
        </div>
    </div>

    <!-- Event Pop-up -->
    <div id="event-popup" class="popup" style="display:none;">
        <div class="popup-content">
            <h3 id="event-title"></h3>
            <p><strong>Date & Time:</strong> <span id="event-date-time"></span></p>
            <p><strong>Link:</strong> <a href="" id="event-link" target="_blank" class="btn btn-info">Event Details</a></p>
            <p><strong>Payment:</strong> <span id="event-payment"></span></p>
            <button onclick="closePopup()" class="btn btn-danger">Close</button>
        </div>
    </div>

    <script>
        // Sample events data
        const events = [
            {
                date: '2025-02-10',
                title: 'Event 1',
                dateTime: '2025-02-10 10:00 AM',
                link: 'https://example.com/event1',
                payment: '$20',
                type: 'danger'
            },
            {
                date: '2025-02-12',
                title: 'Event 2',
                dateTime: '2025-02-12 3:00 PM',
                link: 'https://example.com/event2',
                payment: 'Free',
                type: 'success'
            },
            {
                date: '2025-02-15',
                title: 'Event 3',
                dateTime: '2025-02-15 5:00 PM',
                link: 'https://example.com/event3',
                payment: '$15',
                type: 'primary'
            }
        ];

        let currentMonth = new Date().getMonth();  // Current month (0-11)
        let currentYear = new Date().getFullYear(); // Current year (e.g. 2025)

        // Month names array
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        // Function to generate the calendar for the given month and year
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthYearDisplay = document.getElementById('calendar-month-year');

            // Update the displayed month and year
            monthYearDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); // Get number of days in the month
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // Get day of the week for the 1st of the month

            // Clear the calendar grid
            calendarGrid.innerHTML = '';

            // Add empty cells before the first day of the month
            for (let i = 0; i < firstDayOfMonth; i++) {
                calendarGrid.innerHTML += `<div class="calendar-day"></div>`;
            }

            // Add the days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateString = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const event = events.find(event => event.date === dateString);

                // Highlight event days and add event types (danger, success, primary)
                let eventClass = '';
                if (event) {
                    eventClass = event.type; // Assign class based on event type
                    calendarGrid.innerHTML += `<div class="calendar-day ${eventClass}" onclick="showEventDetails('${event.title}')">
                        ${day}
                    </div>`;
                } else {
                    calendarGrid.innerHTML += `<div class="calendar-day">${day}</div>`;
                }
            }
        }

        // Function to navigate between months
        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();  // Regenerate the calendar after changing the month
        }

        // Function to show event details in a pop-up
        function showEventDetails(eventTitle) {
            const event = events.find(e => e.title === eventTitle);
            if (event) {
                document.getElementById('event-title').innerText = event.title;
                document.getElementById('event-date-time').innerText = event.dateTime;
                document.getElementById('event-link').href = event.link;
                document.getElementById('event-payment').innerText = event.payment;
                document.getElementById('event-popup').style.display = 'flex';
            }
        }

        // Close the event pop-up
        function closePopup() {
            document.getElementById('event-popup').style.display = 'none';
        }

        // Initialize the calendar
        generateCalendar();
    </script>

    <!-- Bootstrap JS (optional, for pop-up functionality) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  </div>

    <script>
        function loadContent(sectionId) {
            const sections = document.querySelectorAll('.content-page');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.style.display = 'block';
            }

            // Update active link in sidebar
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Default content
        document.addEventListener('DOMContentLoaded', () => {
            loadContent('dashboard');
        });

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("show");
        }


        async function fetchAIResponse(prompt) {
    showLoadingPopup("Finishing Touches.....")

    try {
        const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyA5ZvilV3z8XOj0FShLEh8vgNq5SNCzgsE", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }]
            })
        });

        const data = await response.json();
        console.log("üîç Full API Response:", data);

        hideLoadingPopup();

        // Ensure the response has expected structure
        if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content.parts[0].text) {
            alert("Error: AI response is missing expected content.");
            return null;
        }

        // Extract AI response and sanitize JSON
        let aiResponse = data.candidates[0].content.parts[0].text.trim();

        // Remove markdown code block indicators (if present)
        aiResponse = aiResponse.replace(/```json/g, "").replace(/```/g, "").trim();

        console.log("‚úÖ AI Message (Cleaned JSON):", aiResponse);

        return JSON.parse(aiResponse); // Now parse safely
    } catch (error) {
        hideLoadingPopup();
        console.error("‚ùå Gemini API Error:", error);
        alert("Failed to connect to AI. Check your API key or response format.");
        return null;
    }
}


// Function to display worksheet and show download button
function displayWorksheet(questions, topic, ageGroup) {
    const container = document.getElementById("worksheet-display");

    setTimeout(() => {
        if (typeof questions === "string") {
            try {
                questions = JSON.parse(questions); // Convert string to JSON if needed
            } catch (error) {
                console.error("‚ùå Failed to parse AI response as JSON:", error);
                alert("Invalid worksheet data received.");
                container.innerHTML = ""; // Remove loading message
                return;
            }
        }

        if (!questions || !Array.isArray(questions.data)) {
            console.error("‚ùå AI response format is incorrect:", questions);
            alert("Error: AI response format is incorrect.");
            container.innerHTML = ""; // Remove loading message
            return;
        }

        // Remove loading message
        container.innerHTML = "";

        // Create and display the download button
        const downloadBtn = document.createElement("button");
        downloadBtn.className = "btn btn-primary mt-2";
        downloadBtn.innerText = `Download Worksheet: ${topic} (${ageGroup} Years)`;
        downloadBtn.onclick = function () {
            downloadWorksheetPDF(questions.data, topic, ageGroup);
        };

        container.appendChild(downloadBtn);
    }, 2000);
}

// Function to download the worksheet as a PDF
function downloadWorksheetPDF(questions, topic, ageGroup) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    if (!topic || !ageGroup) {
        console.error("‚ùå Missing topic or age group!");
        alert("Error: Topic and age group are required.");
        return;
    }

    // Add title
    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text(`Worksheet of ${topic} for ${ageGroup} Years`, 10, 10);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);

    let yOffset = 30;

    questions.forEach((q, index) => {
        doc.text(`${index + 1}. ${q}`, 10, yOffset);
        yOffset += 10;

        // Add space for solving (two lines)
        doc.line(10, yOffset, 200, yOffset);
        yOffset += 10;
        doc.line(10, yOffset, 200, yOffset);
        yOffset += 15;
    });

    doc.save(`Worksheet_${topic}_${ageGroup}.pdf`);
}




    </script>
</body>
</html>

